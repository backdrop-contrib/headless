language: php
dist: xenial
php:
  - 7.2
cache:
  directories:
    - $HOME/.composer/cache/files
    - $HOME/.composer/cache/repo
services:
  - mysql
addons:
  - mariadb: '10.3'
before_install:
  - pwd
  - ls
  - composer install
  - git clone https://github.com/backdrop/backdrop /home/travis/web
  - git clone https://github.com/drush-ops/drush /home/travis/web/drush
  - git clone https://github.com/backdrop-contrib/backdrop-drush-extension /home/travis/web/drush/commands/backdrop
  - cd /home/travis/web/drush && git checkout 8.x && composer install
  - sudo ln -s /home/travis/web/drush/drush /usr/local/bin/drush
  - mysql -e "drop database if exists backdrop"
  - mysql -e "create database backdrop"
  - cd /home/travis/web
  - cp -av /home/travis/build/backdrop-contrib/headless /home/travis/web/modules/headless
  - drush si --db-url=mysql://root:@127.0.0.1/backdrop
  - drush en headless -y
  - drush en simpletest -y

script:
  # Check code standards
  - cd /home/travis/build/backdrop-contrib/headless
  - >
    vendor/bin/phpcs -n
    --standard=vendor/backdrop/coder/coder_sniffer/Backdrop
    --ignore="vendor/*,README.md"
    --extensions=install,module,php,inc,theme,test .

  # Simpletests
  - >
    /home/travis/web/core/scripts/run-tests.sh
    -u www-data
    --url http://127.0.0.1
    --color
    --verbose
    BackdropHeadlessTestCase


